---
title: "Services & Data Access"
description: "Blazor Spark Data Access"
---

## Introduction
Since Blazor Spark uses EF Core, querying and saving data is straight forward. You can combine that with service classes to make simple, re-usable data access code throughout your application.

## Services
It is advised to use service classes to interact with your data. To create a Service, simply use the Spark `make service` command.

```bash
spark make service DeveloperService
```
A new class in the `Application/Services` folder will be created.

```csharp
public class DeveloperService
{
    private readonly IDbContextFactory<ApplicationDbContext> _factory;

    public DeveloperService(IDbContextFactory<ApplicationDbContext> factory)
    {
        this._factory = factory;
    }
}
```
This class will include a `DBContextFactory` which allows you to query your EF Core models.

> Spark uses a DB Context Factory because Blazor applications do not create a service scope that aligned with the desired DB Context lifetime and will result in errors in your Blazor app.
> You can read more about this [here](https://learn.microsoft.com/en-us/ef/core/dbcontext-configuration/#using-a-dbcontext-factory-eg-for-blazor).

### Registering Services
Before you're able to dependency inject a new service into a Blazor page, you need to register it in the DI container. Spark makes this very simple. 

Simply add your service to the `AddCustomServices` method in the  `Application/Startup/AppServiceRegistration.cs` class.
```csharp
private static IServiceCollection AddCustomServices(this IServiceCollection services)
{
    ...
    services.AddScoped<DeveloperService>();
    return services;
}
```

That's it!

### Injecting Services
Once a service is registered, it can be injected into any Razor component or another registered service.

**Injecting a Service in a Razor component**

Use the `@inject` attribute in a Razor component to inject your services.
```razor
@page "/developers"
@inject DeveloperService developerService

<p>Developer page</p>

@code {
	private List<Developer> developers;

	protected override async Task OnInitializedAsync()
	{
		developers = await developerService.GetAll();
	}
}
```

**Injecting a service into another service**

Use standard dependency injection.
```csharp
public class DeveloperService
{
    private readonly ProjectService _projectService;

    public DeveloperService(ProjectService projectService)
    {
        this._projectService = projectService;
    }

    public List<projects> GetDevelopersProjects(int developerId) {
        return this._projectService.GetProjectsByDeveloperId(developerId);
    }
}
```

>
> For this to work, both the `DeveloperService` and `ProjectService` must be registered in your apps DI container.
>

## Querying Data
In your service classes, you can use LINQ to query data from your database.

```csharp
public class DeveloperService
{
    private readonly IDbContextFactory<ApplicationDbContext> _factory;

    public DeveloperService(IDbContextFactory<ApplicationDbContext> factory)
    {
        this._factory = factory;
    }

    // Get all data
    public async Task<List<Developer>> GetAll()
    {
        using var context = _factory.CreateDbContext();
        return await context.Developers.ToListAsync();
    }
    
    // Get a single entity
    public async Task<Developer> GetDeveloper(int id)
    {
        using var context = _factory.CreateDbContext();
        return await context.Developers
            .SingleAsync(d => d.Id == id);
    }

    // Filter data
    public async Task<List<Developer>> GetDevelopersByName(string name)
    {
        using var context = _factory.CreateDbContext();
        return await context.Developers
            .Where(d => d.Name.Contains(name))
            .ToListAsync();
    }
}
```

Once you add the `DeveloperService` to the DI container in your `Application/Startup/AppServiceRegistration.cs` class, you can call your service from any Blazor Page or component by injecting it.
```razor
@page "/developers"
@inject DeveloperService developerService

<div class="">
    @if (developers == null)
    {
        <p>Loading...</p>
    }
    else
    {
        <ul>
        @foreach (var developer in Developers)
        {
            <li>developer.Name</li>
        }
        </ul>
    }
</div>

@code {
	private List<Developer> developers;

	protected override async Task OnInitializedAsync()
	{
		developers = await developerService.GetAll();
	}
}
```

## Storing Data
Data can be stored using EFCore's `Add` method.

```csharp
public class DeveloperService
{
    private readonly IDbContextFactory<ApplicationDbContext> _factory;

    public DeveloperService(IDbContextFactory<ApplicationDbContext> factory)
    {
        this._factory = factory;
    }

    // Save data
    public async Task<Developer> Store(Developer developer)
    {
        using var context = _factory.CreateDbContext();
        context.Developers.Add(company);
        context.SaveChanges();
        return developer;
    }
}
```